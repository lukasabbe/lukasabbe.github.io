---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
---

<Layout>
	<Header activePage="home" />
	
	<main class="main">
		<h1>Hi, I am Lukas</h1>
		<p>I live in Linköping, Sweden, and I'm studying Software Engineering at LIU. <br> In my spare time, I love working on small development projects, mainly Minecraft modding and Discord bot development.</p>
		<p>A few handpicked projects are listed under <a href="/projects">Projects</a>. But not all—there are more on my <a href="https://github.com/lukasabbe" target="_blank">GitHub</a>.</p>
		<h2>Programming languages</h2>
		<ul>
			<li>Java</li>
			<li>JavaScript/TypeScript</li>
			<li>Python</li>
			<li>C#</li>
			<li>C++/C</li>
			<li>HTML/CSS</li>
			<li>SQL</li>
		</ul>
		<h2>Stats</h2>
		<div class="stats">
			<!-- Add id so we can hook the effect -->
			<div class="stat-item" id="total-downloads">
				<span class="stat-label">Total mod downloads:</span>
				<span class="stat-value" id="mod-downloads">
					<span class="loading">Loading...</span>
				</span>
			</div>
			<div class="stat-item" id="github-repos" style="display: none;">
				<span class="stat-label">GitHub repositories:</span>
				<span class="stat-value" id="github-repos-count">0</span>
			</div>
			<div class="stat-item" id="github-followers" style="display: none;">
				<span class="stat-label">GitHub followers:</span>
				<span class="stat-value" id="github-followers-count">0</span>
			</div>
			<p class="stat-disclaimer" id="api-error" style="display: none;">
				* Data may not be current due to API limitations
			</p>
		</div>
	</main>
</Layout>

<!-- Full-page overlay for confetti -->
<div id="confetti-layer" aria-hidden="true"></div>

<script>
	// -------- Stats fetching (pure JS, no TS types) --------
	async function fetchStats() {
		let apiError = false;
		
		try {
			const response = await fetch('https://api.modrinth.com/v2/user/QCe37V9V/projects');
			if (response.ok) {
				const data = await response.json();
				const totalDownloads = data.reduce((sum, mod) => sum + (mod.downloads || 0), 0);
				const modDownloadsElement = document.getElementById('mod-downloads');
				if (modDownloadsElement) {
					modDownloadsElement.innerHTML = totalDownloads.toLocaleString();
				}
			} else {
				throw new Error('Modrinth API request failed');
			}
		} catch (error) {
			console.error('Failed to fetch mod downloads:', error);
			apiError = true;
			const modDownloadsElement = document.getElementById('mod-downloads');
			if (modDownloadsElement) {
				modDownloadsElement.innerHTML = '1,250+ <span class="stat-note">*</span>';
			}
		}
		
		try {
			const githubResponse = await fetch('https://api.github.com/users/lukasabbe');
			if (githubResponse.ok) {
				const githubData = await githubResponse.json();
				const reposElement = document.getElementById('github-repos-count');
				const reposContainer = document.getElementById('github-repos');
				if (reposElement && reposContainer) {
					reposElement.textContent = String(githubData.public_repos ?? 0);
					reposContainer.style.display = 'flex';
				}
				const followersElement = document.getElementById('github-followers-count');
				const followersContainer = document.getElementById('github-followers');
				if (followersElement && followersContainer) {
					followersElement.textContent = String(githubData.followers ?? 0);
					followersContainer.style.display = 'flex';
				}
			} else {
				throw new Error('GitHub API request failed');
			}
		} catch (error) {
			console.error('Failed to fetch GitHub stats:', error);
		}
		
		if (apiError) {
			const errorElement = document.getElementById('api-error');
			if (errorElement) errorElement.style.display = 'block';
		}
	}
	document.addEventListener('DOMContentLoaded', fetchStats);


  const box = document.getElementById('total-downloads');
  const layer = document.getElementById('confetti-layer');

  const waitTime = 1000;
  let shakeTimeoutId = null;
  let burstTimeoutId = null;
  let lastMouseX = 0;
  let lastMouseY = 0;

  if (box) {
    box.style.cursor = 'pointer';

    // track mouse position while hovering
    box.addEventListener('mousemove', (e) => {
      lastMouseX = e.clientX;
      lastMouseY = e.clientY;
    });

    box.addEventListener('mouseenter', () => {
      shakeTimeoutId = setTimeout(() => {
        box.classList.add('shake');
        burstTimeoutId = setTimeout(() => {
          box.classList.remove('shake');
          burstFrom(lastMouseX, lastMouseY, 90); // use mouse pos
        }, waitTime);
      }, waitTime);
    });

    box.addEventListener('mouseleave', () => {
      if (shakeTimeoutId) clearTimeout(shakeTimeoutId);
      if (burstTimeoutId) clearTimeout(burstTimeoutId);
      box.classList.remove('shake');
    });
  }

  function burstFrom(x, y, count) {
    if (!layer) return;
    for (let i = 0; i < count; i++) {
      const piece = document.createElement('div');
      piece.className = 'confetti';

      piece.style.setProperty('--hue', Math.floor(Math.random() * 360));

      const angle = Math.random() * Math.PI * 2;
      const spread = 140 + Math.random() * 160;
      const dx = Math.cos(angle) * spread;
      const dy = Math.sin(angle) * (spread * 0.7) + (60 + Math.random() * 120);
      const spin = 360 + Math.random() * 1080;
      const dur = 900 + Math.random() * 800;

      piece.style.setProperty('--x', x + 'px');
      piece.style.setProperty('--y', y + 'px');
      piece.style.setProperty('--dx', dx + 'px');
      piece.style.setProperty('--dy', dy + 'px');
      piece.style.setProperty('--spin', spin + 'deg');
      piece.style.setProperty('--dur', dur + 'ms');

      layer.appendChild(piece);
      setTimeout(() => piece.remove(), dur + 60);
    }
  }
</script>

<style>
	.main {
		text-align: center;
		padding: 4rem 2rem;
		max-width: 800px;
		margin: 0 auto;
	}

	.main h1 {
		font-size: 3rem;
		margin-bottom: 1rem;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
	}

	.main h2 {
		font-size: 2rem;
		margin-top: 2rem;
		margin-bottom: 1rem;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
	}

	.main p {
		font-size: 1.2rem;
		color: #666;
	}

	.main ul {
		list-style: none;
		padding: 0;
		margin: 2rem 0;
		display: flex;
		flex-wrap: wrap;
		justify-content: center;
		gap: 1rem;
		max-width: 600px;
		margin-left: auto;
		margin-right: auto;
	}

	.main li {
		background: linear-gradient(135deg, #3F72AF 0%, #577597 100%);
		color: white;
		padding: 0.75rem 1.5rem;
		border-radius: 25px;
		font-weight: 600;
		font-size: 1rem;
		box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
		transition: all 0.3s ease;
		cursor: default;
	}

	.main li:hover {
		transform: translateY(-2px);
		box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
	}

	.stats {
		margin: 2rem 0;
		display: flex;
		flex-direction: column;
		gap: 1rem;
		max-width: 400px;
		margin-left: auto;
		margin-right: auto;
	}

	.stat-item {
		display: flex;
		justify-content: space-between;
		align-items: center;
		background: rgba(255, 255, 255, 0.1);
		padding: 1rem 1.5rem;
		border-radius: 12px;
		border-left: 4px solid #667eea;
		backdrop-filter: blur(10px);
		box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
	}

	/* Shake animation */
	@keyframes shake {
		0%   { transform: translate(0, 0); }
		20%  { transform: translate(-3px, 0) rotate(-1.5deg); }
		40%  { transform: translate(3px, 0) rotate(1.5deg); }
		60%  { transform: translate(-3px, 0) rotate(-1deg); }
		80%  { transform: translate(3px, 0) rotate(1deg); }
		100% { transform: translate(0, 0); }
	}
	.stat-item.shake {
		animation: shake 0.4s linear infinite;
	}

	/* IMPORTANT: make these selectors GLOBAL so dynamically-created nodes match */
	:global(#confetti-layer) {
		position: fixed;
		inset: 0;
		pointer-events: none;
		overflow: visible;
		z-index: 999999;
	}
	:global(.confetti) {
		position: absolute;
		width: 7px;
		height: 12px;
		background: hsl(var(--hue, 0) 90% 60%);
		left: var(--x, 0px);
		top: var(--y, 0px);
		transform: translate(0,0) rotate(0deg);
		opacity: 0;
		animation: fly var(--dur, 1200ms) cubic-bezier(.2,.7,.1,1) forwards;
	}
	@keyframes fly {
		0%   { transform: translate(0,0) rotate(0deg); opacity: 1; }
		60%  { transform: translate(calc(var(--dx)*0.7), calc(var(--dy)*0.6)) rotate(calc(var(--spin)*0.6)); opacity: 1; }
		100% { transform: translate(var(--dx), var(--dy)) rotate(var(--spin)); opacity: 0; }
	}

	.stat-label { font-weight: 500; color: #555; }
	.stat-value { font-weight: 700; font-size: 1.1rem; color: #667eea; }
	.stat-note { color: #ff6b6b; font-size: 0.9rem; margin-left: 0.25rem; }
	.stat-disclaimer { font-size: 0.8rem; color: #888; text-align: center; margin-top: 0.5rem; font-style: italic; }

	.loading { color: #888; font-style: italic; animation: pulse 1.5s ease-in-out infinite; }
	@keyframes pulse { 0% { opacity: 1; } 50% { opacity: .5; } 100% { opacity: 1; } }

	:global(.dark-theme) .main p { color: #ffffff; }
	:global(.dark-theme) .main li { background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%); box-shadow: 0 4px 12px rgba(74,85,104,.3); }
	:global(.dark-theme) .main li:hover { box-shadow: 0 6px 16px rgba(74,85,104,.4); }
	:global(.dark-theme) .stat-item { background: rgba(255,255,255,.05); border-left-color: #9f7aea; }
	:global(.dark-theme) .stat-label { color: #ccc; }
	:global(.dark-theme) .stat-value { color: #9f7aea; }
	:global(.dark-theme) .stat-disclaimer { color: #aaa; }
	:global(.dark-theme) .loading { color: #aaa; }
	:global(.dark-theme) .stat-note { color: #ff8a8a; }

	@media (max-width: 768px) {
		.main { padding: 2rem 1rem; }
		.main h1 { font-size: 2rem; margin-bottom: 1rem; }
		.main h2 { font-size: 1.5rem; margin-top: 1.5rem; margin-bottom: 0.75rem; }
		.main p { font-size: 1.1rem; line-height: 1.6; }
		.main ul { gap: 0.75rem; margin: 1.5rem 0; }
		.main li { padding: 0.6rem 1.2rem; font-size: 0.9rem; }
		.stats { margin: 1.5rem 0; max-width: 100%; }
		.stat-item { padding: 0.75rem 1rem; flex-direction: column; gap: 0.25rem; text-align: center; }
		.stat-value { font-size: 1rem; }
	}

	@media (max-width: 480px) {
		.main { padding: 1.5rem 0.75rem; }
		.main h1 { font-size: 1.75rem; }
		.main h2 { font-size: 1.25rem; margin-top: 1rem; margin-bottom: 0.5rem; }
		.main p { font-size: 1rem; line-height: 1.5; }
		.main ul { gap: 0.5rem; margin: 1rem 0; }
		.main li { padding: 0.5rem 1rem; font-size: 0.8rem; }
		.stats { margin: 1rem 0; }
		.stat-item { padding: 0.5rem 0.75rem; }
		.stat-label, .stat-value { font-size: 0.9rem; }
	}
</style>
